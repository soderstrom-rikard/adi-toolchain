srcdir = @srcdir@
VPATH = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@

bindir = @bindir@
libdir = @libdir@
includedir = @includedir@

CC = @CC@
CPU = @target_cpu@
TARGET = @target_alias@
CFLAGS = @CFLAGS@
INCLUDES = @bfd_include_dir@ @binutils_include_dir@
CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@ -static
LIBS = @LIBS@
INSTALL = @INSTALL@
DEFS = @DEFS@ -DTARGET_$(CPU)

CCFLAGS = $(CFLAGS) $(DEFS) $(INCLUDES)

target_bindir = $(prefix)/$(TARGET)/bin
target_libdir = $(prefix)/$(TARGET)/lib

PROGS = elf2flt flthdr

all: $(PROGS)

elf2flt: $(srcdir)/elf2flt.c Makefile
	$(CC) $(CCFLAGS) $(LDFLAGS) -o $@ $(srcdir)/elf2flt.c $(LIBS)

flthdr: $(srcdir)/flthdr.c Makefile
	$(CC) $(CCFLAGS) $(LDFLAGS) -o $@ $(srcdir)/flthdr.c $(LIBS)

clean:
	-rm -f $(PROGS) *.[oa]

distclean: clean
	-rm -f Makefile config.log config.status config.cache ld-elf2flt

install:
	$(INSTALL) -s -m 755 flthdr $(bindir)/$(TARGET)-flthdr
	$(INSTALL) -s -m 755 flthdr $(target_bindir)/flthdr
	$(INSTALL) -s -m 755 elf2flt $(bindir)/$(TARGET)-elf2flt
	$(INSTALL) -s -m 755 elf2flt $(target_bindir)/elf2flt
	[ -f $(bindir)/$(TARGET)-ld.real ] || \
		mv $(bindir)/$(TARGET)-ld $(bindir)/$(TARGET)-ld.real
	[ -f $(target_bindir)/ld.real ] || \
		mv $(target_bindir)/ld $(target_bindir)/ld.real
	$(INSTALL) -m 755 $(srcdir)/ld-elf2flt $(bindir)/$(TARGET)-ld
	$(INSTALL) -m 755 $(srcdir)/ld-elf2flt $(target_bindir)/ld
	$(INSTALL) -m 644 $(srcdir)/elf2flt.ld $(target_libdir)

